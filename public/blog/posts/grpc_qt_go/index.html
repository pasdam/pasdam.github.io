<!doctype html><html lang=en><head><meta charset=utf-8><title>Use gRPC/protobuf with C++ and Go &ndash; /dev/null
</title><link href="https://fonts.googleapis.com/css?family=Work+Sans:600|Quattrocento+Sans:400,400i,700" rel=stylesheet type=text/css><link rel=icon href=https://pasdam.github.io/favicon.svg><link rel=stylesheet href=https://pasdam.github.io/global.min.css><meta name=description content="Tutorial on how to use gRPC/protobuf with a C++ client and Go server"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=G-H52BY7123V"></script><script async src=https://pasdam.github.io/copy-code-button.min.js onload='setupCopyButtons("copy","copied!")'></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H52BY7123V",{cookie_domain:"pasdam.github.io",cookie_flags:"SameSite=None;Secure"})</script><link href=https://cdn.jsdelivr.net/npm/shareon@2/dist/shareon.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/shareon@2/dist/shareon.iife.js defer init></script></head><body><header id=page-header class=bg-green><nav><div class=logo-container><h1 class=logo>/dev/null - Blog</h1></div><script>function toggleClassNameById(e,t){const n=document.getElementById(e).classList;n.contains(t)?n.remove(t):n.add(t)}</script><button data-collapse-toggle=mega-menu type=button class=mega-menu-toggle aria-controls=mega-menu aria-expanded=false onclick='toggleClassNameById("mega-menu","hidden")'>
<span class=sr-only>Open main menu</span><svg class="icon" aria-hidden="true" fill="none" viewBox="0 0 17 14"><path stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/></svg></button><div id=mega-menu><ul><li><a href=/>Home</a></li><li><a aria-current=true class=ancestor href=/blog/posts/>Blog</a></li><li><a href=https://github.com/pasdam>GitHub</a></li></ul></div></nav></header><div id=main><article class=post-body><h1 class=text-green>Use gRPC/protobuf with C++ and Go</h1><p class=date-read-time>July 24, 2017 &mdash; 4 Min Read</p><div class=tags><div class=tag><a href=/tags/c++/ class=test>C++</a></div><div class=tag><a href=/tags/development/ class=test>Development</a></div><div class=tag><a href=/tags/go/ class=test>Go</a></div><div class=tag><a href=/tags/grpc/ class=test>GRPC</a></div><div class=tag><a href=/tags/protoc/ class=test>Protoc</a></div><div class=tag><a href=/tags/protocol-buffer/ class=test>Protocol Buffer</a></div><div class=tag><a href=/tags/tutorial/ class=test>Tutorial</a></div></div><hr><nav id=TableOfContents><ul><li><a href=#requirements>Requirements</a></li><li><a href=#installation>Installation</a></li><li><a href=#project>Project</a><ul><li><a href=#proto>Proto</a></li><li><a href=#server>Server</a></li><li><a href=#client>Client</a></li></ul></li></ul></nav><hr><div class=content><p>In this guide I will show you how to use <a href=http://www.grpc.io/>gRPC</a> to write a simple client (in C++) and server (in Go) for your service.</p><p>For this tutorial we will use the code available in the following Github project: <a href=https://github.com/pasdam/grpcExample>pasdam/grpcExample</a>.</p><p>For the client, in this article I&rsquo;ll show how to write a command line one, but in the repository there is also a GUI client written with the <a href=https://www.qt.io>Qt framework</a>.</p><h2 id=requirements>Requirements</h2><ul><li>gRPC 1.4.2;</li><li>Go 1.8.3;</li><li>Protobuf 3.3.2;</li><li>g++.</li></ul><p>Note: the code might works also with previous versions, but it was tested only with the specified ones.</p><h2 id=installation>Installation</h2><p>To install the C++ version on MacOS, if you have brew installed just open a terminal and execute:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install grpc pkg-config
</span></span></code></pre></div><p>it will install also the protobuf compiler, protoc.</p><p>Now we need to install the go plugin with the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go get -u github.com/golang/protobuf/protoc-gen-go
</span></span></code></pre></div><p>For other language-specific installation instructions for gRPC runtime, please refer to the <a href=https://github.com/grpc/grpc/blob/master/INSTALL.md>official guide</a>.</p><h2 id=project>Project</h2><p>The folders structure is be the following:</p><pre tabindex=0><code class=language-none data-lang=none>- client
  |- cli
  |- core
  |- qt
- protocol
- server
</code></pre><p>In the <em>client/cli</em> folder we will create the command line c++ client, whereas the Qt one is in <em>client/qt</em>; common files will be stored in <em>client/core</em>. The <em>protocol</em> folder will contains the proto/grpc definitions. And finally the <em>server</em> directory will contains the server written in Go.</p><h3 id=proto>Proto</h3><p>We are going to define a simple greeting service in the file <em>protocol/greeting.proto</em>:</p><p><code>gist:pasdam/98fb5343cb2ed9c3be55148413ae755b</code></p><p>This service has only one method that accept a string parameter and replies with another string.</p><p>Then we need to generate the code to use on both the client and the server, so from the project root execute the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PROTOS_PATH<span style=color:#f92672>=</span>./protocol
</span></span><span style=display:flex><span>OUT_DIR<span style=color:#f92672>=</span>./gen
</span></span><span style=display:flex><span>OUT_GO<span style=color:#f92672>=</span>$OUT_DIR/go
</span></span><span style=display:flex><span>mkdir -p $OUT_GO
</span></span><span style=display:flex><span>protoc -I $PROTOS_PATH --cpp_out<span style=color:#f92672>=</span>$OUT_DIR --go_out<span style=color:#f92672>=</span>plugins<span style=color:#f92672>=</span>grpc:$OUT_GO --grpc_out<span style=color:#f92672>=</span>$OUT_DIR --plugin<span style=color:#f92672>=</span>protoc-gen-grpc<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>which grpc_cpp_plugin<span style=color:#e6db74>`</span> protocol/*.proto
</span></span></code></pre></div><p>and then compile it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd $OUT_DIR
</span></span><span style=display:flex><span>g++ -I/usr/local/include -pthread -std<span style=color:#f92672>=</span>c++11 -c *.cc
</span></span></code></pre></div><p>Note: On Windows, for the last command the include path should be changed.</p><h3 id=server>Server</h3><p>The next step is to implement the service in Go, in the file <em>server/main.go</em>:</p><p><code>gist:pasdam/d05af20fdb57da156af62ea914396611</code></p><p>Nothing complex here, just a couple of things: first we implemented the RPC method, that simply takes the input string and reply prepending &ldquo;Hello " to that. In the <em>main</em> method the first thing we have to do is to specify the port on which the server should respond (we will use it later with the client). Then the last thing to do is to create the server, register the greeting service and start serving the requests.</p><p>To run the server just use the following command from the project root:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd server
</span></span><span style=display:flex><span>go get <span style=color:#75715e># optional</span>
</span></span><span style=display:flex><span>go run main.go
</span></span></code></pre></div><p>Note: the <code>go get</code> command is optional, and it&rsquo;s required only the first time to force the download of all dependencies (all the imported packages).</p><h3 id=client>Client</h3><p>As first thing we will create a wrapper for the stub, that will hide all the complexity for each RPC call.</p><p><code>gist:pasdam/5cc0b4f15ca136485a90da2f528760d2</code></p><p>In particular in the <code>hello</code> method we create the gRPC request and its context, then we perform the RPC and retrieve the response.</p><p>One thing to notice: this class holds a reference to a stub of the service, created in the constructor using a specified <a href=https://grpc.io/docs/guides/concepts.html#channels>channel</a> (more on this later). Such stub is used to deliver the request to the actual service, and hides all the communication logic (i.e. serialization/deserialization).</p><p>The command line client is quite simple: it consists of a small <code>main</code> method that reads from the standard input, executes the request and prints the result:</p><p><code>gist:pasdam/8293dec389e09391ac5b6d9eacd748d6</code></p><p>The only thing to notice here is the <a href=https://grpc.io/docs/guides/concepts.html#channels>channel</a> creation: we specified the address (<code>localhost:9001</code>), and configure it not to use TLS/SSL.</p><p>Next step is to compile the code with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>g++ -I/usr/local/include -pthread -std<span style=color:#f92672>=</span>c++11 -c -o $OUT_DIR/client-cli.o client/cli/main.cpp
</span></span><span style=display:flex><span>g++ $OUT_DIR/greeting.pb.o $OUT_DIR/greeting.grpc.pb.o $OUT_DIR/client-cli.o -L/usr/local/lib <span style=color:#e6db74>`</span>pkg-config --libs grpc++ grpc<span style=color:#e6db74>`</span> -lgrpc++_reflection -lprotobuf -lpthread -ldl -o $OUT_DIR/client-cli
</span></span></code></pre></div><p>And finally we can execute the client with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ $OUT_DIR/client-cli
</span></span><span style=display:flex><span>Insert name: Thor
</span></span><span style=display:flex><span>Greeter received: Hello Thor
</span></span></code></pre></div></div></article><hr><hr><div class=socialshare><p>Share this</p><div class=shareon><a class=facebook title="Share on Facebook"></a><a class=linkedin title="Share on Linkedin"></a><a class=mastodon title="Share on Mastodon"></a><a class=messenger data-fb-app-id=0123456789012345 title="Share on Messenger"></a><a class=pinterest title="Share on Pinterest"></a><a class=pocket title="Share on Pocket"></a><a class=reddit title="Share on Reddit"></a><a class=telegram title="Share on Telegram"></a><a class=twitter title="Share on Twitter"></a><a class=vkontakte title="Share on Vkontakte"></a><a class=whatsapp title="Share on Whatsapp"></a><a class=copy-url title="Copy link"></a><a class=email title="Share by Email"></a><a class=print title=Print></a></div></div><hr><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//pasdam-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<button class=hidden id=to-top-button onclick=goToTop() title="Go To Top">
<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chevron-circle-up" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm231-113.9L103.5 277.6c-9.4 9.4-9.4 24.6.0 33.9l17 17c9.4 9.4 24.6 9.4 33.9.0L256 226.9l101.6 101.6c9.4 9.4 24.6 9.4 33.9.0l17-17c9.4-9.4 9.4-24.6.0-33.9L273 142.1c-9.4-9.4-24.6-9.4-34 0z"/></svg>
</button>
<script async>const offset=100;var toTopButton=document.getElementById("to-top-button");window.onscroll=function(){document.body.scrollTop>offset||document.documentElement.scrollTop>offset?toTopButton.classList.remove("hidden"):toTopButton.classList.add("hidden")};function goToTop(){window.scrollTo({top:0,behavior:"smooth"})}</script></body></html>